<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> ØªØ­Ø¯ÙŠØ§Øª ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„ØªØ¹Ù„ÙŠÙ…  </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            min-height: 100vh;
            color: white;
        }
        .card {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .option-btn {
            transition: all 0.2s ease;
        }
        .option-btn:hover {
            transform: translateX(-5px);
            background: rgba(59, 130, 246, 0.2);
        }
        .progress-fill {
            transition: width 0.5s ease-in-out;
        }
    </style>
</head>
<body class="flex flex-col items-center justify-center p-4">

    <!-- Splash Screen -->
    <div id="start-screen" class="max-w-2xl w-full text-center p-8 card rounded-3xl shadow-2xl">
        <div class="mb-6 inline-block p-4 bg-blue-600 rounded-full shadow-lg shadow-blue-500/50">
             <svg
    xmlns="http://www.w3.org/2000/svg"
    viewBox="0 0 24 24"
    fill="currentColor"
    class="h-7 w-7">
    <path
      d="M11.7 2.805a.75.75 0 01.6 0A60.65 60.65 0 0122.83 8.72a.75.75 0 01-.231 1.337 49.949 49.949 0 00-9.902 3.912l-.003.002-.34.18a.75.75 0 01-.707 0A50.009 50.009 0 007.5 12.174v-.224c0-.131.067-.248.172-.311a54.614 54.614 0 014.653-2.52.75.75 0 00-.65-1.352 56.129 56.129 0 00-4.78 2.589 1.858 1.858 0 00-.859 1.228 49.803 49.803 0 00-4.634-1.527.75.75 0 01-.231-1.337A60.653 60.653 0 0111.7 2.805z" />
    <path
      d="M13.06 15.473a48.45 48.45 0 017.666-3.282c.134 1.414.22 2.843.255 4.285a.75.75 0 01-.46.71 47.878 47.878 0 00-8.105 4.342.75.75 0 01-.832 0 47.877 47.877 0 00-8.104-4.342.75.75 0 01-.461-.71c.035-1.442.121-2.87.255-4.286A48.4 48.4 0 016 13.18v1.27a1.5 1.5 0 00-.14 2.508c-.09.38-.222.753-.397 1.11.452.213.901.434 1.346.661a6.729 6.729 0 00.551-1.608 1.5 1.5 0 00.14-2.67v-.645a48.549 48.549 0 013.44 1.668 2.25 2.25 0 002.12 0z" />
    <path
      d="M4.462 19.462c.42-.419.753-.89 1-1.394.453.213.902.434 1.347.661a6.743 6.743 0 01-1.286 1.794.75.75 0 11-1.06-1.06z" />
  </svg>
        </div>
        <h1 class="text-4xl font-bold mb-4">ØªØ­Ø¯ÙŠØ§Øª ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„ØªØ¹Ù„ÙŠÙ… ÙˆØ§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</h1>
        <p class="text-gray-300 mb-8 text-lg">Ø§Ù„ØªÙˆÙÙŠÙ‚ Ù„Ù…Ù† ÙˆÙÙ‚Ù‡ Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø³.. Ø®Ø¯ Ø¨Ø§Ù„Ø£Ø³Ø¨Ø§Ø¨ ÙˆØ¨Ø°Ù„ Ù…Ø¬Ù‡ÙˆØ¯ Ù„ÙƒÙ† Ø§Ù„Ù„ÙŠ Ø±Ø¨Ù†Ø§ Ø¨ÙŠÙˆÙÙ‚Ù‡ Ø¨Ø³ Ù‡Ùˆ Ø§Ù„Ù„ÙŠ Ø¨ÙŠÙˆØµÙ„.!</p>
        <!-- Small leaderboard preview on start -->
        <div class="mb-6 text-right bg-gray-800/40 p-4 rounded-lg">
            <div class="flex items-center justify-between mb-2">
                <div class="font-semibold">Ø§Ù„Ù…ØªØµØ¯Ø±ÙˆÙ†</div>
                <div class="text-xs text-gray-400">Ø£Ø¹Ù„Ù‰ 5</div>
            </div>
                <div id="start-leaderboard-list" class="space-y-1 text-sm text-gray-200"></div>
                <script>
                    // Populate the start screen leaderboard once the scripts and DOM are ready
                    document.addEventListener('DOMContentLoaded', function () {
                        try {
                            if (window.leaderboard && typeof window.leaderboard.renderTo === 'function') {
                                // If the helper exposes a ready promise, wait for it; otherwise call directly
                                if (window.leaderboard.ready && typeof window.leaderboard.ready.then === 'function') {
                                    window.leaderboard.ready.then(() => window.leaderboard.renderTo('start-leaderboard-list', 5));
                                } else {
                                    window.leaderboard.renderTo('start-leaderboard-list', 5);
                                }
                            }
                        } catch (e) {
                            console.error('Auto-render start leaderboard failed', e);
                        }
                    });
                </script>
        </div>

        <div class="flex flex-col items-center">
            <div id="quiz-status" class="text-sm text-gray-300 mb-3">Ø¬Ø§Ø±Ù Ø¬Ù„Ø¨ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©...</div>
            <button id="start-btn" onclick="startGame()" disabled class="bg-blue-600/60 text-white font-bold py-3 px-12 rounded-full text-xl transition-all transform">
                Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ­Ø¯ÙŠ Ø§Ù„Ø¢Ù†
            </button>
        </div>
    </div>

    <!-- Game Container -->
    <div id="game-container" class="hidden max-w-2xl w-full">
        <!-- Header Info -->
        <div class="flex justify-between items-center mb-6 px-4">
            <div class="flex items-center gap-2">
                <span class="text-gray-400">Ø§Ù„Ø³Ø¤Ø§Ù„:</span>
                <span id="question-count" class="font-bold text-blue-400 text-xl">1/10</span>
            </div>
            <div class="flex items-center gap-2">
                <span class="text-gray-400">Ø§Ù„Ù†Ù‚Ø§Ø·:</span>
                <span id="score" class="font-bold text-green-400 text-xl">0</span>
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="w-full bg-gray-700 h-2 rounded-full mb-8 overflow-hidden">
            <div id="progress-bar" class="progress-fill bg-blue-500 h-full w-0"></div>
        </div>

        <!-- Question Card -->
        <div class="card p-8 rounded-3xl shadow-2xl">
            <h2 id="question-text" class="text-2xl font-bold mb-8 leading-relaxed">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¤Ø§Ù„...</h2>
            <div id="options-container" class="space-y-4">
                <!-- Options will be injected here -->
            </div>
        </div>

        <!-- Feedback Area -->
        <div id="feedback" class="mt-6 text-center h-8 font-bold text-lg hidden"></div>
    </div>

    <!-- Results Screen -->
    <div id="results-screen" class="hidden max-w-2xl w-full text-center p-8 card rounded-3xl shadow-2xl">
        <h2 class="text-4xl font-bold mb-4">Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ØªØ­Ø¯ÙŠ!</h2>
        <div class="text-6xl font-bold text-blue-500 mb-6" id="final-score">0</div>
        <p id="evaluation-text" class="text-xl text-gray-300 mb-4"></p>

        <!-- Career Rank Display -->
        <div id="career-rank" class="mb-4 text-lg font-semibold text-yellow-300"></div>

        <!-- Name input & submit to leaderboard -->
        <div class="flex flex-col sm:flex-row items-center justify-center gap-3 mb-4">
            <input id="player-name" type="text" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ†" class="p-3 rounded-lg text-black w-full sm:w-2/3" />
            <button id="submit-score-btn" onclick="submitScoreFromResults()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-full">Ù†Ø´Ø± Ø§Ù„Ù†ØªÙŠØ¬Ø©</button>
            <button id="view-leaderboard-btn" onclick="window.leaderboard && window.leaderboard.renderTo && window.leaderboard.renderTo('leaderboard-list',10)" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-full">Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ†</button>
        </div>

        <!-- Leaderboard area (filled by leaderboard.js) -->
        <div id="leaderboard-container" class="text-right bg-gray-800/40 p-4 rounded-lg max-h-72 overflow-auto">
            <div id="leaderboard-list" class="space-y-2 text-sm text-gray-200"></div>
        </div>

        <div class="mt-6">
            <button onclick="location.reload()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-12 rounded-full text-xl transition-all transform hover:scale-105">
                Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©
            </button>
        </div>
    </div>
    <script>
    
        let quizData = [
            {
                question: "ÙŠÙØ§ Ø­ÙÙŠÙÙ‘ ÙŠÙØ§ Ù‚ÙŠÙÙ‘ÙˆÙ…Ù Ø¨ÙØ±ÙØ­Ù’Ù…ÙØªÙÙƒÙ Ø£Ø³Ù’ØªÙØºÙÙŠØ«Ù Ø£ØµÙ’Ù„ÙØ­Ù’ Ù„ÙÙŠ Ø´ÙØ£Ù†ÙÙŠ ÙƒÙÙ„ÙÙ‘Ù‡Ù ÙˆÙÙ„Ø§Ù ØªÙÙƒÙÙ„Ù’Ù†ÙÙŠ Ø¥Ù„ÙÙ‰ Ù†ÙÙÙ’Ø³ÙÙŠ Ø·ÙÙ€Ø±Ù’ÙÙØ©Ù Ø¹ÙÙŠÙ’Ù†Ù. ",
                options: [" ØªØ­Ù‚ÙŠÙ‚ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù ", " Ø·Ù„Ø¨ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ù…Ù† Ø§Ù„Ù„Ù‡ ", " Ø§Ù„ØµØ¨Ø± Ø¹Ù„Ù‰ Ø§Ù„Ù…ØµØ§Ø¹Ø¨ ", " Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø¬Ø§Ø¯ "],
                correct: 1,
                hint: "Ø¯Ø¹Ø§Ø¡ Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¹ÙˆÙ† Ø§Ù„Ø¥Ù„Ù‡ÙŠ ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù…ÙˆØ±."
            },
            {
                question: "Ø­ÙØ³Ù’Ø¨ÙÙ€ÙŠÙ Ø§Ù„Ù„Ù‘Ù‡Ù Ù„Ø§ Ø¥Ù„Ù‡Ù Ø¥Ù„Ø§Ù‘ Ù‡ÙÙˆÙ Ø¹ÙÙ„ÙÙ€ÙŠÙ‡Ù ØªÙÙˆÙÙƒÙ‘ÙÙ€Ù„ØªÙ ÙˆÙÙ‡ÙÙˆÙ Ø±ÙØ¨Ù‘Ù Ø§Ù„Ø¹ÙØ±Ù’Ø´Ù Ø§Ù„Ø¹ÙØ¸Ù€ÙŠÙ…. ",
                options: [" Ø§Ù„Ø«Ù‚Ø© Ø¨Ø§Ù„Ù„Ù‡ ", " Ø§Ù„Ø§Ø³ØªØºÙØ§Ø± ", " Ø§Ù„ØµØ¯Ù‚Ø© ", " Ø§Ù„ØµÙ„Ø§Ø© "],
                correct: 0,
                hint: "Ø¯Ø¹Ø§Ø¡ Ù„Ù„ØªÙˆÙƒÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù„Ù‡ ÙÙŠ ÙƒÙ„ Ø§Ù„Ø£Ù…ÙˆØ±."
            },
            {
                question: "Ø§Ù„Ù„Ù‘ÙÙ‡ÙÙ…Ù‘Ù Ø¥ÙÙ†Ù‘ÙÙŠ Ø£ÙØ³Ù’Ø£ÙÙ„ÙÙƒÙ Ø¹ÙÙ„Ù’Ù…Ù‹Ø§ Ù†ÙØ§ÙÙØ¹Ù‹Ø§ØŒ ÙˆÙØ±ÙØ²Ù’Ù‚Ù‹Ø§ Ø·ÙÙŠÙ‘ÙØ¨Ù‹Ø§ØŒ ÙˆÙØ¹ÙÙ…ÙÙ„Ù‹Ø§ Ù…ÙØªÙÙ‚ÙØ¨Ù‘ÙÙ„Ù‹Ø§.",
                options: [" Ø·Ù„Ø¨ Ø§Ù„Ø¹Ù„Ù… ", " Ø·Ù„Ø¨ Ø§Ù„Ø±Ø²Ù‚ ", " Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„ØµØ§Ù„Ø­ ", " Ø¬Ù…ÙŠØ¹ Ù…Ø§ Ø³Ø¨Ù‚ "],
                correct: 3,
                hint: "Ø¯Ø¹Ø§Ø¡ ÙŠØ´Ù…Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø¹Ù„Ù…ØŒ Ø§Ù„Ø±Ø²Ù‚ØŒ ÙˆØ§Ù„Ø¹Ù…Ù„ Ø§Ù„Ù…Ù‚Ø¨ÙˆÙ„."
            },
            {
                question: "Ø±ÙØ¨Ù‘Ù Ø§Ø´Ù’Ø±ÙØ­Ù’ Ù„ÙÙŠ ØµÙØ¯Ù’Ø±ÙÙŠ ÙˆÙÙŠÙØ³Ù‘ÙØ±Ù’ Ù„ÙÙŠ Ø£ÙÙ…Ù’Ø±ÙÙŠ ÙˆÙØ§Ø­Ù’Ù„ÙÙ„Ù’ Ø¹ÙÙ‚Ù’Ø¯ÙØ©Ù‹ Ù…ÙÙ†Ù’ Ù„ÙØ³ÙØ§Ù†ÙÙŠ ÙŠÙÙÙ’Ù‚ÙÙ‡ÙÙˆØ§ Ù‚ÙÙˆÙ’Ù„ÙÙŠ.",
                options: [" Ø·Ù„Ø¨ Ø§Ù„ÙÙ‡Ù… ", " Ø·Ù„Ø¨ Ø§Ù„ØªÙŠØ³ÙŠØ± ÙÙŠ Ø§Ù„Ø£Ù…ÙˆØ± ", " Ø·Ù„Ø¨ Ø§Ù„Ø«Ù‚Ø© Ø¨Ø§Ù„Ù†ÙØ³ ", " Ø·Ù„Ø¨ Ø§Ù„Ø­ÙƒÙ…Ø© "],
                correct: 1,
                hint: "Ø¯Ø¹Ø§Ø¡ Ù„Ø·Ù„Ø¨ Ø§Ù„ØªÙŠØ³ÙŠØ± ÙÙŠ Ø§Ù„Ø£Ù…ÙˆØ± ÙˆÙÙ‡Ù… Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†."
            },
            {
                question: "Ø§Ù„Ù„Ù‘ÙÙ‡ÙÙ…Ù‘Ù Ø§Ø¬Ù’Ø¹ÙÙ„Ù’ ÙÙÙŠ Ù‚ÙÙ„Ù’Ø¨ÙÙŠ Ù†ÙÙˆØ±Ù‹Ø§ØŒ ÙˆÙÙÙÙŠ Ù„ÙØ³ÙØ§Ù†ÙÙŠ Ù†ÙÙˆØ±Ù‹Ø§ØŒ ÙˆÙÙÙÙŠ Ø³ÙÙ…Ù’Ø¹ÙÙŠ Ù†ÙÙˆØ±Ù‹Ø§ØŒ ÙˆÙÙÙÙŠ Ø¨ÙØµÙØ±ÙÙŠ Ù†ÙÙˆØ±Ù‹Ø§ØŒ ÙˆÙÙ…ÙÙ†Ù’ ÙÙÙˆÙ’Ù‚ÙÙŠ Ù†ÙÙˆØ±Ù‹Ø§ØŒ ÙˆÙÙ…ÙÙ†Ù’ ØªÙØ­Ù’ØªÙÙŠ Ù†ÙÙˆØ±Ù‹Ø§ØŒ ÙˆÙØ¹ÙÙ†Ù’ ÙŠÙÙ…ÙÙŠÙ†ÙÙŠ Ù†ÙÙˆØ±Ù‹Ø§ØŒ ÙˆÙØ¹ÙÙ†Ù’ Ø´ÙÙ…ÙØ§Ù„ÙÙŠ Ù†ÙÙˆØ±Ù‹Ø§ØŒ ÙˆÙÙ…ÙÙ†Ù’ Ø£ÙÙ…ÙØ§Ù…ÙÙŠ Ù†ÙÙˆØ±Ù‹Ø§ØŒ ÙˆÙÙ…ÙÙ†Ù’ Ø®ÙÙ„Ù’ÙÙÙŠ Ù†ÙÙˆØ±Ù‹Ø§. ",
                options: [" Ø·Ù„Ø¨ Ø§Ù„Ù‡Ø¯Ø§ÙŠØ© ", " Ø·Ù„Ø¨ Ø§Ù„Ù†ÙˆØ± ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬ÙˆØ§Ù†Ø¨ ", " Ø·Ù„Ø¨ Ø§Ù„Ø³Ù„Ø§Ù…Ø© ", " Ø·Ù„Ø¨ Ø§Ù„Ø±Ø­Ù…Ø© "],
                correct: 1,
                hint: "Ø¯Ø¹Ø§Ø¡ Ù„Ø·Ù„Ø¨ Ø§Ù„Ù†ÙˆØ± ÙˆØ§Ù„Ù‡Ø¯Ø§ÙŠØ© ÙÙŠ ÙƒÙ„ Ø¬Ø§Ù†Ø¨ Ù…Ù† Ø¬ÙˆØ§Ù†Ø¨ Ø§Ù„Ø­ÙŠØ§Ø©."
            }
        ]; 

    let currentQuestion = 0;
    let score = 0;
    // attempts: number of incorrect attempts made for the current question (0 or 1)
    let attempts = 0;

        function startGame() {
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('game-container').classList.remove('hidden');
            loadQuestion();
        }

        function loadQuestion() {
            const q = quizData[currentQuestion];
            document.getElementById('question-text').innerText = q.question;
            // reset attempts for this question
            attempts = 0;
            document.getElementById('question-count').innerText = `${currentQuestion + 1}/${quizData.length}`;
            
            const progress = ((currentQuestion) / quizData.length) * 100;
            document.getElementById('progress-bar').style.width = progress + '%';

            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';
            
            q.options.forEach((opt, index) => {
                const btn = document.createElement('button');
                btn.className = "option-btn w-full text-right p-4 rounded-xl border border-gray-600 bg-gray-800/50 hover:border-blue-500 flex items-center gap-4 group";
                btn.innerHTML = `
                    <span class="w-8 h-8 rounded-full bg-gray-700 flex items-center justify-center group-hover:bg-blue-600 transition-colors">${index + 1}</span>
                    <span class="text-lg">${opt}</span>
                `;
                btn.onclick = () => checkAnswer(index);
                optionsContainer.appendChild(btn);
            });
        }
        function checkAnswer(selected) {
            const correct = quizData[currentQuestion].correct;
            const feedback = document.getElementById('feedback');
            feedback.classList.remove('hidden');

            const buttons = document.getElementsByClassName('option-btn');

            // If the selected answer is correct
            if (selected === correct) {
                if (attempts === 0) {
                    // Correct on first attempt: full mark
                    score += 10;
                    feedback.innerText = "Ø£Ø­Ø³Ù†Øª! Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø© ğŸŒŸ";
                    feedback.className = "mt-6 text-center h-8 font-bold text-lg text-green-400";
                } else {
                    // Correct on second attempt: half mark
                    score += 5;
                    feedback.innerText = "Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø© â€” Ù†ØµÙ Ø§Ù„Ø¹Ù„Ø§Ù…Ø© âœ… (+5 Ù†Ù‚Ø§Ø·)";
                    feedback.className = "mt-6 text-center h-8 font-bold text-lg text-yellow-300";
                }
                document.getElementById('score').innerText = score;
                // Highlight correct
                buttons[correct].classList.add('bg-green-600/30', 'border-green-500');

                // disable all to prevent further clicks
                Array.from(buttons).forEach(btn => btn.disabled = true);

                // After showing feedback, move to next question
                setTimeout(() => {
                    feedback.classList.add('hidden');
                    currentQuestion++;
                    if (currentQuestion < quizData.length) {
                        loadQuestion();
                    } else {
                        showResults();
                    }
                }, 1500);

            } else {
                // Answer is incorrect
                if (attempts === 0) {
                    // First incorrect attempt: allow a second attempt
                    attempts = 1;
                    feedback.innerText = "Ø®Ø§Ø·Ø¦ â€” Ù„Ø¯ÙŠÙƒ Ù…Ø­Ø§ÙˆÙ„Ø© Ø«Ø§Ù†ÙŠØ©. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.";
                    feedback.className = "mt-6 text-center h-8 font-bold text-lg text-red-400";
                    // Mark this button as incorrect and disable it so user can't pick same wrong answer
                    buttons[selected].classList.add('bg-red-600/30', 'border-red-500');
                    buttons[selected].disabled = true;
                    // Keep other buttons enabled for the second attempt
                } else {
                    // Second incorrect attempt: show correct answer and skip question
                    feedback.innerText = "Ù„Ù„Ø£Ø³ÙØŒ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©. Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ù…Ø¹Ù„Ù…Ø© Ø£Ø¯Ù†Ø§Ù‡.";
                    feedback.className = "mt-6 text-center h-8 font-bold text-lg text-red-400";
                    // highlight selected as wrong and correct answer
                    buttons[selected].classList.add('bg-red-600/30', 'border-red-500');
                    buttons[correct].classList.add('bg-green-600/30', 'border-green-500');
                    // disable all
                    Array.from(buttons).forEach(btn => btn.disabled = true);

                    setTimeout(() => {
                        feedback.classList.add('hidden');
                        currentQuestion++;
                        if (currentQuestion < quizData.length) {
                            loadQuestion();
                        } else {
                            showResults();
                        }
                    }, 1500);
                }
            }
        }

        function showResults() {
            document.getElementById('game-container').classList.add('hidden');
            document.getElementById('results-screen').classList.remove('hidden');
            document.getElementById('final-score').innerText = score + " Ù†Ù‚Ø·Ø©";
            
            let evaluation = "";
            if (score >= 90) evaluation = "Ø£Ù†Øª Ù…Ø®Ø±Ø¬ Ù…Ø­ØªØ±Ù! Ù„Ø¯ÙŠÙƒ Ù…Ø¹Ø±ÙØ© ØªÙ‚Ù†ÙŠØ© ÙˆÙÙ†ÙŠØ© Ù…Ø°Ù‡Ù„Ø©.";
            else if (score >= 70) evaluation = "Ø±Ø§Ø¦Ø¹! Ù…Ø³ØªÙˆØ§Ùƒ Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹ØŒ Ù‚Ù„ÙŠÙ„ Ù…Ù† Ø§Ù„Ù…Ù…Ø§Ø±Ø³Ø© ÙˆØªØµØ¨Ø­ Ø®Ø¨ÙŠØ±Ø§Ù‹.";
            else if (score >= 50) evaluation = "Ø¬ÙŠØ¯ØŒ Ù„ÙƒÙ†Ùƒ ØªØ­ØªØ§Ø¬ Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø¨Ø¹Ø¶ Ø§Ù„Ù…ÙØ§Ù‡ÙŠÙ… Ø§Ù„ØªÙ‚Ù†ÙŠØ©.";
            else evaluation = "ÙŠØ¨Ø¯Ùˆ Ø£Ù†Ùƒ ÙÙŠ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø·Ø±ÙŠÙ‚ØŒ Ø±Ø§Ø¬Ø¹ Ø§Ù„Ù…Ù†Ù‡Ø¬ ÙˆØ­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.";

            document.getElementById('evaluation-text').innerText = evaluation;

            // Career ranking calculation
            function calculateCareerRank(s) {
                // Ranks from lowest to highest, ending with "Stream Legend"
                // These thresholds are adjustable. Max possible score in this quiz = 100.
                if (s >= 90) return {rank: 'Stream Legend', level: 6, note: 'ØªØ­ÙƒÙ… ÙƒØ§Ù…Ù„ Ø¨Ø§Ù„Ù…Ø®Ø±Ø¬Ø§Øª ÙˆØ§Ù„Ù…Ù‡Ø§Ø±Ø§Øª.'};
                if (s >= 80) return {rank: 'Prodigy', level: 5, note: 'Ù…Ø³ØªÙˆÙ‰ Ø§Ø­ØªØ±Ø§ÙÙŠ Ù…ØªÙ‚Ø¯Ù….'};
                if (s >= 60) return {rank: 'Director', level: 4, note: 'Ù…Ø®Ø±Ø¬ Ù…ØªÙ…Ø±Ø³ Ù‚Ø§Ø¯Ø± Ø¹Ù„Ù‰ Ù‚ÙŠØ§Ø¯Ø© Ø§Ù„Ø¥Ù†ØªØ§Ø¬.'};
                if (s >= 40) return {rank: 'Producer', level: 3, note: 'ÙÙ‡Ù… Ø¬ÙŠØ¯ Ù„Ù„Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©.'};
                if (s >= 20) return {rank: 'Apprentice', level: 2, note: 'ØªØ­ØªØ§Ø¬ Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„ØªØ¯Ø±ÙŠØ¨ ÙˆØ§Ù„ØªØ¬Ø±Ø¨Ø©.'};
                return {rank: 'Trainee', level: 1, note: 'Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø·Ø±ÙŠÙ‚Ø› ØªØ§Ø¨Ø¹ Ø§Ù„ØªØ¹Ù„Ù… ÙˆØ§Ù„Ù…Ù…Ø§Ø±Ø³Ø©.'};
            }

            const career = calculateCareerRank(score);
            const careerEl = document.getElementById('career-rank');
            careerEl.innerText = `Ø±ØªØ¨ØªÙƒ: ${career.rank} â€” ${career.note}`;

            // After showing results, prepare leaderboard state using shared leaderboard helper
            window.submitScoreFromResults = function() {
                const nameInput = document.getElementById('player-name');
                const rawName = (nameInput && nameInput.value) ? nameInput.value.trim() : '';
                const playerName = rawName || 'Ù…Ø´Ø§Ø±Ùƒ Ù…Ø¬Ù‡ÙˆÙ„';

                const btn = document.getElementById('submit-score-btn');
                btn.disabled = true;
                const prevText = btn.innerText;
                btn.innerText = 'Ø¬Ø§Ø±Ù Ø§Ù„Ù†Ø´Ø±...';

                if (window.leaderboard && typeof window.leaderboard.submitScore === 'function') {
                    window.leaderboard.submitScore(playerName, score, career.rank).then(() => {
                        btn.innerText = 'ØªÙ… Ø§Ù„Ù†Ø´Ø± âœ“';
                        setTimeout(() => { btn.innerText = prevText; btn.disabled = false; }, 1500);
                        // refresh leaderboard view
                        window.leaderboard.renderTo('leaderboard-list', 10);
                    }).catch(err => {
                        console.error('Failed to submit to leaderboard', err);
                        btn.innerText = 'ÙØ´Ù„ Ø§Ù„Ù†Ø´Ø±';
                        setTimeout(() => { btn.innerText = prevText; btn.disabled = false; }, 2000);
                        // still try to refresh from local/remote
                        if (window.leaderboard && typeof window.leaderboard.renderTo === 'function') window.leaderboard.renderTo('leaderboard-list', 10);
                    });
                } else {
                    // No leaderboard helper, just refresh local view
                    if (window.leaderboard && typeof window.leaderboard.renderTo === 'function') window.leaderboard.renderTo('leaderboard-list', 10);
                    btn.innerText = 'ØªÙ… Ø§Ù„Ø­ÙØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹';
                    setTimeout(() => { btn.innerText = prevText; btn.disabled = false; }, 1200);
                }
            };
        }
    </script>
    <!-- Optional: Supabase configuration (uncomment and fill) -->
    <script>
        // To use Supabase set these values before loading leaderboard.js
        window.SUPABASE_URL = 'https://xmobyzmaoxkscmrblceq.supabase.co';
        window.SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhtb2J5em1hb3hrc2NtcmJsY2VxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcwMjk3ODAsImV4cCI6MjA4MjYwNTc4MH0.wEUs_bjRaDR32ISQcrt7qAnYXX-8rmdWwpo3LRnhcAc';
    </script>

    <!-- Firebase SDK (compat) and leaderboard integration (Firestore unused if Supabase is configured) -->
    <!-- Replace firebaseConfig below in html5/data/js/leaderboard.js with your project's config or set it here as window.FIREBASE_CONFIG -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <script>window.LEADERBOARD_AUTO_DEMO = false;</script>
    <script src="html5/data/js/leaderboard.js"></script>
    <script>
        // Try to load questions from Supabase (if configured). This will replace quizData when rows exist.
        (function(){
            try {
                if (window.leaderboard && typeof window.leaderboard.ready.then === 'function') {
                    window.leaderboard.ready.then(() => {
                        if (typeof window.leaderboard.fetchQuestions === 'function') {
                            window.leaderboard.fetchQuestions().then(rows => {
                                if (rows && rows.length > 0) {
                                    // Map Supabase rows to the quizData shape used by the game
                                    quizData = rows.map(r => ({
                                        question: r.question || '',
                                        options: Array.isArray(r.options) ? r.options : (r.options ? JSON.parse(r.options) : []),
                                        correct: (typeof r.correct === 'number') ? r.correct : parseInt(r.correct, 10) || 0,
                                        hint: r.hint || ''
                                    }));
                                    console.log('Quiz: loaded', quizData.length, 'questions from Supabase');
                                    const status = document.getElementById('quiz-status');
                                    if (status) status.innerText = `ØªÙ… ØªØ­Ù…ÙŠÙ„ ${quizData.length} Ø³Ø¤Ø§Ù„Ø§Ù‹ Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…`;
                                } else {
                                    console.log('Quiz: no questions found in Supabase, using local quizData fallback');
                                    const status = document.getElementById('quiz-status');
                                    if (status) status.innerText = 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¦Ù„Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù… â€” Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…Ø­Ù„ÙŠØ©';
                                }
                            }).catch(err => {
                                console.error('Quiz: failed to fetch questions from Supabase', err);
                                const status = document.getElementById('quiz-status');
                                if (status) status.innerText = 'ÙØ´Ù„ Ø¬Ù„Ø¨ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù… â€” Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…Ø­Ù„ÙŠØ©';
                            }).finally(() => {
                                // enable start button regardless of success so user can play
                                const startBtn = document.getElementById('start-btn');
                                if (startBtn) { startBtn.disabled = false; startBtn.classList.remove('bg-blue-600/60'); startBtn.classList.add('bg-blue-600','hover:bg-blue-700'); }
                            });
                        }
                    }).catch(err => console.error('leaderboard.ready rejected', err));
                }
            } catch (e) { console.error('Quiz load error', e); }
        })();
    </script>
</body>
</html>
